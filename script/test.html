<!DOCTYPE html>
<html>
	<head>
            <title>Funny test</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
            <style>
                  .question {
                        font-size: 20px;
                        font-weight: bold;
                        margin: 30px 20px;
                  }
                  .answers {
                        font-size: 18px;
                        margin: 30px 20px;
                        border: 3px solid transparent;
                  }
                  h2 {
                        font-size: 22px;
                        font-weight: bold;
                        color: rgb(3, 0, 190);
                        text-align: center;
                  }
                  h3 {
                        font-size: 18px;
                        text-align: center;
                        color: rgb(216, 0, 11);
                  }
                  #submit {
                        font-family: 'Times New Roman';
                        margin-left: 60px;
                        font-size: 20px;
                        font-weight: bold;
                  }

                  .result {
                        font-size: 22px;
                        margin: 30px 20px;
                        color: rgb(3, 0, 190);
                  }
            </style>
		<script>
                  /* Задача 3 (с измененным условием). Написать программу выдачи и обработки теста. 
                  Исходные данные для теста: дан массив, состоящий из массивов вопросов. 
                  Каждый вопрос состоит из трех элементов: собственно вопроса, массива ответов, номера ответа, 
                  за который полагается 1 балл.  

                  Массив с исходными данными загружается сразу. Вопросы  выводить по очереди, под текстом 
                  вопроса должен быть выведен список ответов с радио-кнопками перед ними. 
                  После ответа на последний вопрос вывести результат теста: 
                  указать количество правильных ответов и сообщение о наличии юмора. 
                  
                  Обработка результатов: в случае, если тестируемый набрал в сумме больше или равно 4 балла, 
                  следует дать ответ: «Юмор в Вас просто бурлит!», если от 2 до 3 баллов, то «У Вас есть 
                  зачатки юмора!», иначе – «Смотрите на жизнь веселей!».*/

                  window.onload = function() {
                       
                        //массив данных - вопрос, варианты ответов, правильный (+1 балл)
                        let test = [
                              ["Если кто-то идет в лес на ходулях, зачем он это делает?",["чтобы было интересней","боится змей","чтобы лучше видеть грибы"],3],
                              ["Ваш коллега уснул на работе. Вы:",["громко хлопните дверью","выпьете его кофе","позовете начальника, чтобы его разбудить"],3],
                              ["Прохожий просит дать ему 50 рублей. Вы отвечаете:",["Вы читаете мои мысли!","Зарплату задерживают","Зачем они Вам?"],1],
                              ["Вы видите объявление, что отдают крылья от старого москвича. Вы считаете, что:",["автор не знает, куда деньги девать","старые москвичи уже не летают","автор с ума сошел!"],2],
                              ["В переполненном трамвае Вам встали на ногу и не собираются сходить. Вы скажете:",["Пардон, но нога на которой Вы стоите - моя","Не поменяться ли нам местами?","Подвиньтесь, пожалуйста"],2]
                        ]
                        let answersOfTest = [];              //массив ответов (из условия)

                        //заголовок к тесту
                        let heading = document.createElement("h2");
                        heading.textContent = `Ответьте на несколько вопросов и узнайте, как у вас обстоят дела с чувством юмора :)`;
                        document.querySelector("body").prepend(heading);

                        //пояснение (другой вариант я не нашла :( )
                        let notice = document.createElement("h3");
                        notice.textContent = `Менять вариант ответа нельзя!`;
                        document.querySelector("h2").after(notice);

                        for (let i = 0; i < test.length; i++) {
                              let variants;                       //блок вариантов ответов

                              //выгрузка вопроса
                              let question = document.createElement("div");
                              question.setAttribute("class","question");
                              const q = document.createElement("p");
                              q.textContent = `${i+1}. ${test[i][0]}`;
                              question.append(q);
                              document.querySelector("form").append(question);

                              //выгрузка вариантов ответов
                              let answers = document.createElement("div");
                              answers.setAttribute("class","answers");
                              variants = `
                                    <div>
                                          <input type="radio" name="answer${i}" id="a1${i}" value="1" />
                                          <label for="a1${i}">${test[i][1][0]}</label>
                                    </div>
                                    <div>
                                          <input type="radio" name="answer${i}" id="a2${i}" value="2" />
                                          <label for="a2${i}">${test[i][1][1]}</label>
                                    </div>
                                    <div>
                                          <input type="radio" name="answer${i}" id="a3${i}" value="3" />
                                          <label for="a3${i}">${test[i][1][2]}</label>
                                    </div>
                              `;
                              answers.insertAdjacentHTML("beforeEnd",variants);
                              question.after(answers);   

                              //выгрузка номеров ответов в отдельный массив
                              answersOfTest[i] = test[i][2];
                        } 

                        //клик по радио-кнопке
                        let choice = document.querySelectorAll(".answers input");
                        console.log(choice);
                        choice.forEach(function(input,j,arr) {
                              input.onclick = function() {
                                    input.setAttribute("class","checked");

                                    //стилизация выбранного блока (с выбранным ответом)                 
                                    let blockChecked = input.parentElement.parentElement;
                                    console.log(blockChecked);
                                    blockChecked.style.border = "3px solid green";
                                    blockChecked.classList.add("yes");
                              };
                        })

                        //доступ к кнопке Ответить - проверка и подсчет результата
                        let done = document.querySelector("#submit");
                        done.addEventListener("click",check);

                        function check () {
                              let box = document.querySelectorAll(".answers");
                              console.log(box);
                              let count = 0;
                              box.forEach(function(elem,i,arr) {
                                    if(elem.className.includes("answers yes")) {
                                         count++;  
                                         console.log(count);
                                    }
                                    else {
                                          elem.style.border = "3px solid red";
                                    }
                              })
                              if (count === box.length){
                                    score();
                              }
                        }

                        function score () {
                              let chosenVariant = document.querySelectorAll(".checked");

                              let numberOfAnswer = [];
                              chosenVariant.forEach(function(elem,i,arr) {
                                    let numb = +elem.value;
                                    numberOfAnswer.push(numb);
                              })
                              console.log(numberOfAnswer);
                              console.log(answersOfTest);

                              //если число выбранных вариантов больше числа вопросов
                              if (numberOfAnswer.length > test.length) {
                                    alert("Страница будет перезагружена. Не меняйте свои ответы!");
                                    location.reload();
                              }

                              //выгрузка результата теста
                              function resultTxt () {
                                    let rightAnswer = 0;            //начальное кол-во правильных ответов

                                    for (let j = 0, k = 0; j < numberOfAnswer.length, k < answersOfTest.length; j++, k++) 
                                    { 
                                          if (numberOfAnswer.length == answersOfTest.length) {
                                                if (numberOfAnswer[j] == answersOfTest[k]) {
                                                      rightAnswer += 1;
                                                      console.log(`Правильных ответов: ${rightAnswer}`); 
                                                }
                                                else {
                                                      rightAnswer += 0;
                                                      console.log(`Правильных ответов: ${rightAnswer}`);
                                                } 
                                          }
                                    } 
                                    
                                    document.testForm.style.display = "none"; //скрыть форму после ответа
                                    done.style.display = "none";               //скрыть кнопку "Ответить"
                                    heading.style.display = "none";           //скрыть заголовок
                                    notice.style.display = "none";             //скрыть пояснение

                                    let final = document.querySelector(".result");
                                    const result = document.createElement("p");
                                    result.textContent = `Правильных ответов: ${rightAnswer}. ${about()}`;
                                    final.append(result);

                                    function about () {
                                          let aboutResult;
                                          switch (rightAnswer) {
                                                case 0: 
                                                case 1: 
                                                      aboutResult = "Смотрите на жизнь веселей!"; break;
                                                case 2: 
                                                case 3: 
                                                      aboutResult = "У Вас есть зачатки юмора!"; break;
                                                case 4: 
                                                case 5: 
                                                      aboutResult = "Юмор в Вас просто бурлит!"; break;
                                          }
                                          return aboutResult;
                                    }
                              }
                              resultTxt();   
                        }
                  }
		</script>
	</head>
	<body>
            <form method="get" enctype="application/x-www-form-urlencoded" name="testForm">
            </form>

            <input type="submit" name="submit" id="submit" value="Ответить"/>
            <div class="result"></div>
	</body>
</html>